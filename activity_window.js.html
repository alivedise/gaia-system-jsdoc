<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: activity_window.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: activity_window.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>(function(window) {
  /**
   * ActivityWindow is exactly an specific app window but contains
   * a mozbrowser iframe runnign as an inline activity.
   * 
   * An ActivityWindow instance is created, managed by another AppWindow instance.
   *
   * That means an ActivityWindow instance could also opens another ActivityWindow instance.
   *
   * @param {AppWindow} app    The ActivityWindow opener. Will be stored at |this.parentWindow|.
   * @param {Object} config The configuration of the inline activity window.
   *
   * @extends {AppWindow}
   * @requires AppWindow
   * @class  ActivityWindow
   */
  window.ActivityWindow = function ActivityWindow(app, config) {
    this.config = config;

    /**
     * Specify we're belong to which appWindow instance.
     * @type {AppWindow}
     */
    this.parentWindow = app;

    var evt = document.createEvent('CustomEvent');
    evt.initCustomEvent('activitywillopen', true, true, { origin: config.origin });

    // Create the &lt;iframe mozbrowser mozapp> that hosts the app
    var frame = createFrame(null, origin, url, name, manifest, manifestURL);
    var iframe = frame.firstChild;
    frame.classList.add('inlineActivity');
    iframe.dataset.frameType = 'inline-activity';

    iframe.setAttribute('expecting-system-message',
                        'expecting-system-message');
    maybeSetFrameIsCritical(iframe, origin);

    // Give a name to the frame for differentiating between main frame and
    // inline frame. With the name we can get frames of the same app using the
    // window.open method.
    iframe.name = 'inline';
    iframe.dataset.start = Date.now();

    this.resize();

    frame.addEventListener('mozbrowserloadend', function activityloaded(e) {
      e.target.removeEventListener(e.type, activityloaded, true);

      var evt = document.createEvent('CustomEvent');
      evt.initCustomEvent('activityloadtime', true, false, {
        time: parseInt(Date.now() - iframe.dataset.start),
        type: 'c', // Activity is always cold booted now.
        src: iframe.src
      });
      iframe.dispatchEvent(evt);
    }, true);

    // Add the iframe to the document
    windows.appendChild(frame);

    // Open the frame, first, store the reference
    openFrame = frame;

    setVisibilityForInlineActivity(true);

    setVisibilityForCurrentApp(false);

    if ('orientation' in manifest) {
      frame.dataset.orientation = manifest.orientation;
      setOrientationForInlineActivity(frame);
    }

    setFrameBackground(openFrame, function gotBackground() {
      // Start the transition when this async/sync callback is called.
      openFrame.classList.add('active');
      if (inlineActivityFrames.length == 1)
        activityCallerOrigin = displayedApp;
      if ('wrapper' in runningApps[displayedApp].frame.dataset) {
        wrapperFooter.classList.remove('visible');
        wrapperHeader.classList.remove('visible');
      }
    });

    this.config.iframe = this.iframe = iframe;
    this.config.frame = this.frame = frame;
  };

  /**
   * ActivityWindow is inherited from appWindow;
   */
  ActivityWindow.prototype.__proto__ = AppWindow.prototype;

  /**
   * The super class reference.
   * @private
   * @type {Function}
   */
  ActivityWindow.prototype._super = AppWindow;

  /**
   * Class name is used to add a type-specific class on the element.
   * We also use the CLASSNAME + _id to specify &lt;code>element.id&lt;/code>.
   * @static
   * @type {String}
   */
  ActivityWindow.prototype.CLASSNAME = 'inlineActivity';

  ActivityWindow.prototype.resize = function actw_resize(width, height) {
    // Borrow the window size from parent window
    // Copy the dimension of the currently displayed app
    if (!this.parentWindow)
      return;

    // Traverse the inline activity chain to resize the latest one.
    if (this.inlineActivityWindow) {
      this.inlineActivityWindow.resize(width, height);
    } else {
      this.element.style.width = width;
      this.element.style.height = height;
    }
  }

  /**
   * Event prefix presents the object type
   * when publishing an event from the element.
   * @type {String}
   */
  ActivityWindow.eventPrefix = 'activity';

  /**
   * Destroy the window and release the resource.
   */
  ActivityWindow.prototype.kill = function actw_kill() {
    this.parentWindow = null;
    // If frame is transitioning we should remove the reference
    // ?
    // 
    this.publish('willclose');

    // If frame is never set visible, we can remove the frame directly
    // without closing transition
    if (!this.element.classList.contains('active')) {
      this.element.parentNode.removeChild(this.element);
      return;
    }
    // Take keyboard focus away from the closing window
    this.element.firstChild.blur();
    // Remove the active class and start the closing transition
    this.element.classList.remove('active');
  };
}(this));</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="ActivityWindow.html">ActivityWindow</a></li><li><a href="AppWindow.html">AppWindow</a></li><li><a href="BrowserConfig.html">BrowserConfig</a></li><li><a href="BrowserFrame.html">BrowserFrame</a></li><li><a href="HomescreenWindow.html">HomescreenWindow</a></li></ul><h3>Events</h3><ul><li><a href="ActivityWindow.html#event:appcreated">appcreated</a></li><li><a href="ActivityWindow.html#event:appopen">appopen</a></li><li><a href="ActivityWindow.html#event:appterminated">appterminated</a></li><li><a href="ActivityWindow.html#event:appwillclose">appwillclose</a></li><li><a href="AppWindow.html#event:appcreated">appcreated</a></li><li><a href="AppWindow.html#event:appopen">appopen</a></li><li><a href="AppWindow.html#event:appterminated">appterminated</a></li><li><a href="AppWindow.html#event:appwillclose">appwillclose</a></li><li><a href="HomescreenWindow.html#event:appcreated">appcreated</a></li><li><a href="HomescreenWindow.html#event:appopen">appopen</a></li><li><a href="HomescreenWindow.html#event:appterminated">appterminated</a></li><li><a href="HomescreenWindow.html#event:appwillclose">appwillclose</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AnimatedIcon">AnimatedIcon</a></li><li><a href="global.html#Clock">Clock</a></li><li><a href="global.html#DeviceStorageWatcher">DeviceStorageWatcher</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#stop">stop</a></li><li><a href="global.html#SystemDialog">SystemDialog</a></li><li><a href="global.html#SystemScreen">SystemScreen</a></li><li><a href="global.html#timeoutID">timeoutID</a></li><li><a href="global.html#timerID">timerID</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Sun Jun 23 2013 01:49:03 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
